function renderHandler(t){return"string"==typeof t?document.createTextNode(t):function renderNode(t){let e=t,r="function"==typeof t.render;r&&(e=t.render(),t.vNode=e);const{tag:n,attrs:s,children:i}=e;let o=document.createElement(n);for(const[t,e]of Object.entries(s))t.startsWith("on")?o.addEventListener(t.substring(2).toLowerCase(),e):o.setAttribute(t,e);for(const t of i)o.appendChild(renderHandler(t));return r&&(t.vBase=o),o}(t)}function diffChildren(t,e){let r=[];t.forEach(((t,n)=>{r.push(diffTree(t,e[n]))}));let n=[];for(const r of e.slice(t.length))n.push((t=>(t.appendChild(renderHandler(r)),t)));return t=>{for(const[e,n]of function zip(t,e){const r=[];for(let n=0;n<Math.min(t,e);n++)r.push([t[n],e[n]]);return r}(r,t.childNodes))e(n);for(const e of n)e(t);return t}}function diffTree(t,e){if(!e)return t=>{t.remove()};if("string"==typeof t||"string"==typeof e)return t!==e?t=>{const r=renderHandler(e);return t.replaceWith(r),r}:t=>t;if(t.tag!==e.tag)return t=>{const r=renderHandler(e);return t.replaceWith(r),r};const r=function diffAttrs(t,e){let r=[];for(const[t,n]of Object.entries(e))r.push((e=>(t.startsWith("on")?e.addEventListener(t.substring(2).toLowerCase(),n):e.setAttribute(t,n),e)));for(const n in t)n in e||r.push((t=>(t.removeAttribute(n),t)));return t=>{for(const e of r)e(t);return t}}(t.attrs,e.attrs),n=diffChildren(t.children,e.children);return t=>(r(t),n(t),t)}const t=function arch(t){return(e,...r)=>({tag:t,attrs:e,children:r.flat()||r})}("a");let e;class Link extends class Component{constructor(...t){let e=t.shift()||{};this.props=Object.assign(e,{children:t.flat().filter((t=>t))||[]}),this.vNode=null,this.vBase=null,this.state={}}setState(t){this.state=Object.assign({},this.state,"function"==typeof t?t(this.state,this.props):t),function renderComponent(t){let e=t.render();t.vBase=diffTree(t.vBase,e)(t.vBase),t.vNode=e}(this)}}{constructor(...t){super(...t),this.handleClick=this.handleClick.bind(this)}handleClick(t){if(!(t.ctrlKey||t.metaKey||t.shiftKey)){if(t.preventDefault(),!e)throw new Error("You must declare an router before you can use link components.");return e.navigate(this.props.href),!1}}render(){let e=Object.assign({},this.props,{onClick:this.handleClick});return delete e.children,t(e,this.props.children)}}class Router{constructor(t){this.routes={},this.current=location.pathname,this.root=t,this.init(),e=this}get(t,e){this.routes[t]=e}remove(t){delete this.routes[t]}init(){window.addEventListener("popstate",(t=>{null!==t.state&&this.restoreHistory()}))}async restoreHistory(t){this.saveHistory(),t=t||location.pathname+location.search,force.clear(),await this.render(t),this.current=t}pushUrlHistory(t){history.pushState({url:t},"",t)}saveHistory(){let t=this.current||location.pathname+location.search;history.replaceState({url:t},document.title,location.href)}async navigate(t){this.current!==t&&(await this.restoreHistory(t),this.pushUrlHistory(t))}start(){this.render(this.current)}async render(t){this.routes.hasOwnProperty(t)?render(await this.routes[t]({pathname:t}),this.root):render(await this.routes[404]({pathname:t}),this.root)}}export{Link,Router};
//# sourceMappingURL=index.mjs.map
